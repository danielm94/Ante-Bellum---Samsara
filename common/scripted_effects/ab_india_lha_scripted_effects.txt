lha_upgrade_idea_set = {
	if = {
		limit = {
			NOT = {
				OR = {
					tag = LHA
					tag = GPH
				}
			}
		}
		#Guard clause
	}
	else_if = {
		limit = {
			check_variable = {
				which = lha_idea_level
				value = 0
			}
			NOT = {
				check_variable = {
					which = lha_idea_level
					value = 1
				}
			}
		}
		#Increment idea improvement level
		hidden_effect = {
			change_variable = {
				which = lha_idea_level
				value = 1
			}
		}
		custom_tooltip = lha_upgrade_idea_set_tooltip_1
		hidden_effect = {
			swap_free_idea_group = yes
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = lha_idea_level
				value = 1
			}
			NOT = {
				check_variable = {
					which = lha_idea_level
					value = 2
				}
			}
		}
		#Increment idea improvement level
		hidden_effect = {
			change_variable = {
				which = lha_idea_level
				value = 1
			}
		}
		custom_tooltip = lha_upgrade_idea_set_tooltip_2
		hidden_effect = {
			swap_free_idea_group = yes
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = lha_idea_level
				value = 2
			}
			NOT = {
				check_variable = {
					which = lha_idea_level
					value = 3
				}
			}
		}
		#Increment idea improvement level
		hidden_effect = {
			change_variable = {
				which = lha_idea_level
				value = 1
			}
		}
		custom_tooltip = lha_upgrade_idea_set_tooltip_3
		hidden_effect = {
			swap_free_idea_group = yes
		}
	}
	else = {
		custom_tooltip = lha_upgrade_idea_set_tooltip_max
	}
}

lha_rule_indochina_upgrade_effect = {
	random_owned_province = {
		limit = {
			OR = {
				region = indo_china_region
				region = burma_region
				area = north_tenasserim_area
				area = tenasserim_area
			}
			has_production_building_trigger = yes
			NOT = {
				has_province_flag = lha_rule_indochina_upgraded
			}
		}
		set_province_flag = lha_rule_indochina_upgraded
		add_province_modifier = {
			name = lha_indochinese_economic_expansion
			duration = -1
		}
		add_or_upgrade_production_building = yes
	}
}

lha_cross_the_sulu_sea_reward = {
	every_province = {
		limit = {
			OR = {
				area = west_mindanao_area
				area = mindanao_area
				area = visayas_area
				area = palawan_area
				area = southern_luzon_area
				area = luzon_area
			}
			is_empty = yes
		}
		random_variable = {
			which = rand_var
			value = 20
		}
		add_siberian_construction = 0
		change_religion = ROOT
		if = {
			limit = {
				check_variable = {
					which = rand_var
					value = 0
				}
				NOT = {
					check_variable = {
						which = rand_var
						value = 1
					}
				}
			}
			change_trade_goods = cloves
		}
		else = {
			change_trade_goods = spices
		}
	}
}

lha_the_eastern_gate_reward = {
	random_owned_province = {
		limit = {
			OR = {
				area = fujian_area
				area = zhejiang_area
				area = south_anhui_area
				area = south_jiangsu_area
			}
			has_trade_building_trigger = yes
			NOT = {
				has_province_flag = lha_the_eastern_gate_upgraded
			}
		}
		add_or_upgrade_trade_building = yes
		set_province_flag = lha_the_eastern_gate_upgraded
	}
}

lha_consolidate_gujarat_reward = {
	random_owned_province = {
		limit = {
			region = west_india_region
			has_trade_building_trigger = yes
			NOT = {
				has_province_flag = lha_consolidate_gujarat_upgraded
			}
		}
		add_province_modifier = {
			name = lha_riches_of_gujarat
			duration = -1
		}
		set_province_flag = lha_consolidate_gujarat_upgraded
		add_or_upgrade_trade_building = yes
	}
}

lha_tibetanize_china = {
	if = {
		limit = {
			culture_group = thai_group
		}
		change_culture = bai
	}
	else_if = {
		limit = {
			culture_group = chinese_culture
		}
		change_culture = gya
	}
}

lha_subjugate_oirat_friend = {
	if = {
		limit = {
			still_buddies_with_drb = yes
		}
		create_subject = {
			subject_type = mongol_brother_realm
			subject = DRB
		}
		DRB = {
			change_religion = vajrayana
			add_country_modifier = {
				name = lha_reveres_the_dalai_lama
				duration = -1
			}
		}
	}
	else_if = {
		limit = {
			still_buddies_with_kht = yes
		}
		create_subject = {
			subject_type = mongol_brother_realm
			subject = KHT
		}
		KHT = {
			change_religion = vajrayana
			add_country_modifier = {
				name = lha_reveres_the_dalai_lama
				duration = -1
			}
		}
	}
	else_if = {
		limit = {
			still_buddies_with_trg = yes
		}
		create_subject = {
			subject_type = mongol_brother_realm
			subject = TRG
		}
		TRG = {
			change_religion = vajrayana
			add_country_modifier = {
				name = lha_reveres_the_dalai_lama
				duration = -1
			}
		}
	}
	else_if = {
		limit = {
			still_buddies_with_oir = yes
		}
		create_subject = {
			subject_type = mongol_brother_realm
			subject = OIR
		}
		OIR = {
			change_religion = vajrayana
			add_country_modifier = {
				name = lha_reveres_the_dalai_lama
				duration = -1
			}
		}
	}
}

lha_maritime_guild_effect = {
	$province_id$ = {
		if = {
			limit = {
				NOT = {
					province_has_center_of_trade_of_level = 1
				}
			}
			center_of_trade = 1
		}
		upgrade_center_of_trade = {
			province = $province_id$
		}
	}
	$province_id$ = {
		upgrade_trade_building = yes
		if = {
			limit = {
				has_dock_building_trigger = yes
			}
			upgrade_dock_building = yes
		}
		else_if = {
			limit = {
				has_shipyard_building_trigger = yes
			}
			upgrade_shipyard_building = yes
		}
		add_province_modifier = {
			name = lha_thriving_local_maritime_guild
			duration = -1
		}
	}
}

gya_autonymous_guild_privilege_effect = {
	every_province = {
		limit = {
			superregion = china_superregion
			has_port = yes
			owned_by = ROOT
			NOT = {
				has_province_modifier = lha_thriving_local_maritime_guild
			}
			NOT = {
				has_province_modifier = estate_gya_thriving_guild_city				#Boosted modifier
			}
		}
		set_variable = {
			which = currentTradePower
			value = 0
		}
		export_to_variable = {
			which = provinceTradePower
			value = modifier:province_trade_power_value
		}
		change_variable = {
			which = currentTradePower
			which = provinceTradePower
		}
		if = {
			limit = {
				NOT = {
					has_saved_event_target = highest_trade_province
				}
			}
			save_event_target_as = highest_trade_province
		}
		else = {
			if = {
				limit = {
					check_variable = {
						which = currentTradePower
						which = event_target:highest_trade_province
					}
				}
				save_event_target_as = highest_trade_province
			}
		}
	}
	event_target:highest_trade_province = {
		add_province_modifier = {
			name = estate_gya_thriving_guild_city
			duration = -1
		}
		if = {
			limit = {
				NOT = {
					province_has_center_of_trade_of_level = 1
				}
			}
			center_of_trade = 1
		}
		upgrade_center_of_trade = {
			province = event_target:highest_trade_province
		}
	}
}

gya_upgrade_guild_modifier_effect = {
	every_owned_province = {
		limit = {
			superregion = china_superregion
			has_port = yes
			has_province_modifier = lha_thriving_local_maritime_guild
		}
		remove_province_modifier = lha_thriving_local_maritime_guild
		add_province_modifier = {
			name = estate_gya_thriving_guild_city
			duration = -1
		}
	}
	set_country_flag = gya_upgraded_guild_modifiers
}
